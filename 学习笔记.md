---
author: 小莫
date: 2016-05-19
title: three.js学习
tags:
- es6
- javascript
- three.js
category: VR
permalink: vr_three
---
Three.js是一个3D JavaScript库。是VR开发的一个强有力的工具。
<!--more-->
[![点击访问小莫的github](http://static.xiaomo.info/images/javascript.png)](https://github.com/qq83387856)

<!-- more -->
## 一、three.js简介
如此简介的描述背后，是作者对其强大功能的自信。那么，Three.js究竟能用来干什么呢？Three.js封装了底层的图形接口，使得程序员能够在无需掌握繁冗的图形学知识的情况下，也能用简单的代码实现三维场景的渲染。我们都知道，更高的封装程度往往意味着灵活性的牺牲，但是Three.js在这方面做得很好。几乎不会有WebGL支持而Three.js实现不了的情况，而且就算真的遇到这种情况，你还是能同时使用WebGL去实现，而不会有冲突。当然，除了WebGL之外，Three.js还提供了基于Canvas、SVG标签的渲染器，但由于通常WebGL能够实现更灵活的渲染效果，所以本书主要针对基于WebGL渲染器进行说明。

## 二、 three.js 构成元素
### 1. 渲染器（Renderer）
渲染器将和Canvas元素进行绑定，如果之前在HTML中手动定义了id为mainCanvas的Canvas元素，那么Renderer可以这样写：

```
    var renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById('mainCanvas')
    });
```

而如果想要Three.js生成Canvas元素，在HTML中就不需要定义Canvas元素，在JavaScript代码中可以这样写：

```
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(400, 300);
    document.getElementsByTagName('body')[0].appendChild(renderer.domElement);
```

上面代码的第二行表示设置Canvas的宽400像素，高300像素。第三行将渲染器对应的Canvas元素添加到<body>中。
我们可以使用下面的代码将背景色（用于清除画面的颜色）设置为黑色：

`renderer.setClearColor(0x000000);`

### 2. 场景（Scene）
在Three.js中添加的物体都是添加到场景中的，因此它相当于一个大容器。一般说，场景里没有很复杂的操作，在程序最开始的时候进行实例化，然后将物体添加到场景中即可。

```
    var scene = new THREE.Scene();
```

### 3. 照相机（Camera）
在介绍照相机设置前，我们先来简单了解下坐标系。WebGL和Three.js使用的坐标系是右手坐标系，看起来就是这样的：
![](http://static.xiaomo.info/images/xyz.png)
我们使用Three.js创建的场景是三维的，而通常情况下显示屏是二维的，那么三维的场景如何显示到二维的显示屏上呢？照相机就是这样一个抽象，它定义了三维空间到二维屏幕的投影方式，用“照相机”这样一个类比，可以使我们直观地理解这一投影方式。
而针对投影方式的不同，照相机又分为正交投影照相机与透视投影照相机。我们需要为自己的程序选择合适的照相机。

```
    var camera = new THREE.PerspectiveCamera(45, 4 / 3, 1, 1000);
    camera.position.set(0, 0, 5);
    scene.add(camera);
```

正交投影   
`THREE.OrthographicCamera(left, right, top, bottom, near, far)`

这六个参数分别代表正交投影照相机拍摄到的空间的六个面的位置，这六个面围成一个长方体，我们称其为视景体（Frustum）。只有在视景体内部（下图中的灰色部分）的物体才可能显示在屏幕上，而视景体外的物体会在显示之前被裁减掉。
![](http://static.xiaomo.info/images/zhengjiao.png)

透视投影照相机（Perspective Camera）的构造函数是：
`THREE.PerspectiveCamera(fov, aspect, near, far)`
让我们通过一张透视照相机投影的图来了解这些参数。
![](http://static.xiaomo.info/images/toushi.png)
透视图中，灰色的部分是视景体，是可能被渲染的物体所在的区域。fov是视景体竖直方向上的张角（是角度制而非弧度制），如侧视图所示。
aspect等于width / height，是照相机水平方向和竖直方向长度的比值，通常设为Canvas的横纵比例。
near和far分别是照相机到视景体最近、最远的距离，均为正值，且far应大于near。
值得注意的是，照相机也需要被添加到场景中。

### 4. 演员(Player)
`THREE.CubeGeometry(width, height, depth, widthSegments, heightSegments, depthSegments)`
这里，width是x方向上的长度；height是y方向上的长度；depth是z方向上的长度；后三个参数分别是在三个方向上的分段数，如widthSegments为3的话，代表x方向上水平分为三份。一般情况下不需要分段的话，可以不设置后三个参数，后三个参数的缺省值为1。其他几何形状中的分段也是类似的，下面不做说明。

长方体  
我们要创建一个x、y、z方向长度分别为1、2、3的长方体，并将其设置为红色。

```
var cube = new THREE.Mesh(new THREE.CubeGeometry(1, 2, 3),
        new THREE.MeshBasicMaterial({
            color: 0xff0000
        })
);

scene.add(cube);
```


平面
`THREE.PlaneGeometry(width, height, widthSegments, heightSegments)`
其中，width是x方向上的长度；height是y方向上的长度；后两个参数同样表示分段。
new THREE.PlaneGeometry(2, 4);创建的平面在x轴和y轴所在平面内，效果如下：
![](http://static.xiaomo.info/images/pingmian.png)

球
球体（SphereGeometry）的构造函数是：
`THREE.SphereGeometry(radius, segmentsWidth, segmentsHeight, phiStart, phiLength, thetaStart, thetaLength)`

`var sphere = new THREE.SphereGeometry(3, 8, 6)` 创建一个半径为3，经度划分成8份，纬度划分成6份的球体
其中，radius是半径；
segmentsWidth表示经度上的切片数；   
segmentsHeight表示纬度上的切片数；   
phiStart表示经度开始的弧度； 
phiLength表示经度跨过的弧度；  
thetaStart表示纬度开始的弧度；  
thetaLength表示纬度跨过的弧度。   

圆形
圆形（CircleGeometry）可以创建圆形或者扇形，其构造函数是：

`THREE.CircleGeometry(radius, segments, thetaStart, thetaLength)`
这四个参数都是球体中介绍过的，这里不再赘述，直接来看个例子。`new THREE.CircleGeometry(3, 18, Math.PI / 3, Math.PI / 3 * 4)`可以创建一个在x轴和y轴所在平面的三分之二圆的扇形：


圆柱体

圆柱体（CylinderGeometry）的构造函数是：

`THREE.CylinderGeometry(radiusTop, radiusBottom, height, radiusSegments, heightSegments, openEnded)`
其中，radiusTop与radiusBottom分别是顶面和底面的半径，由此可知，当这两个参数设置为不同的值时，实际上创建的是一个圆台；height是圆柱体的高度；radiusSegments与heightSegments可类比球体中的分段；openEnded是一个布尔值，表示是否没有顶面和底面，缺省值为false，表示有顶面和底面。

正四面体
`THREE.TetrahedronGeometry(radius, detail)`
正八面体
`THREE.OctahedronGeometry(radius, detail)`
正十二面体
`THREE.IcosahedronGeometry(radius, detail)`

这段代码也是比较容易理解的，虽然你现在可能还不知道MeshBasicMaterial是什么，但是大致可以猜测出这是一种材质，可以用来设置物体的颜色。还是要提醒下，一定要记得把创建好的长方体添加到场景中。
那么这里长度为1的单位是什么呢？这里的长度是在物体坐标系中的，其单位与屏幕分辨率等无关，简单地说，它就是一个虚拟空间的坐标系，1代表多少并没有实际的意义，而重要的是相对长度。


圆环面

圆环面（TorusGeometry）就是甜甜圈的形状，其构造函数是：

`THREE.TorusGeometry(radius, tube, radialSegments, tubularSegments, arc)`


圆环结

如果说圆环面是甜甜圈，那么圆环结（TorusKnotGeometry）就是打了结的甜甜圈，其构造参数为：

`THREE.TorusKnotGeometry(radius, tube, radialSegments, tubularSegments, p, q, heightScale)`
前四个参数在圆环面中已经有所介绍，p和q是控制其样式的参数，一般可以缺省，如果需要详细了解，请学习圆环结的相关知识；heightScale是在z轴方向上的缩放。


### 5. 渲染
在定义了场景中的物体，设置好的照相机之后，渲染器就知道如何渲染出二维的结果了。这时候，我们只需要调用渲染器的渲染函数，就能使其渲染一次了。

```
    renderer.render(scene, camera);
```

## 三、栗子

```
    function init() {
        // renderer
        var renderer = new THREE.WebGLRenderer({
            canvas: document.getElementById('mainCanvas')
        });
        renderer.setClearColor(0x000000); // black
    
        // scene
        var scene = new THREE.Scene();
    
        // camera
        var camera = new THREE.PerspectiveCamera(45, 4 / 3, 1, 1000);
        camera.position.set(0, 0, 5);
        scene.add(camera);
    
        // a cube in the scene
        var cube = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 3),
                new THREE.MeshBasicMaterial({
                    color: 0xff0000
                })
        );
        scene.add(cube);
    
        // render
        renderer.render(scene, camera);
    }
```

四、 api列表

Cameras（照相机，控制投影方式）

    Camera
    OrthographicCamera
    PerspectiveCamera

Core（核心对象）

    BufferGeometry
    Clock（用来记录时间）
    EventDispatcher
    Face3
    Face4
    Geometry
    Object3D
    Projector
    Raycaster（计算鼠标拾取物体时很有用的对象）

Lights（光照）
    Light
    AmbientLight
    AreaLight
    DirectionalLight
    HemisphereLight
    PointLight
    SpotLight

Loaders（加载器，用来加载特定文件）
    Loader
    BinaryLoader
    GeometryLoader
    ImageLoader
    JSONLoader
    LoadingMonitor
    SceneLoader
    TextureLoader

Materials（材质，控制物体的颜色、纹理等）
    Material
    LineBasicMaterial
    LineDashedMaterial
    MeshBasicMaterial
    MeshDepthMaterial
    MeshFaceMaterial
    MeshLambertMaterial
    MeshNormalMaterial
    MeshPhongMaterial
    ParticleBasicMaterial
    ParticleCanvasMaterial
    ParticleDOMMaterial
    ShaderMaterial
    SpriteMaterial

Math（和数学相关的对象）

    Box2
    Box3
    Color
    Frustum
    Math
    Matrix3
    Matrix4
    Plane
    Quaternion
    Ray
    Sphere
    Spline
    Triangle
    Vector2
    Vector3
    Vector4

Objects（物体）

    Bone
    Line
    LOD
    Mesh（网格，最常用的物体）
    MorphAnimMesh
    Particle
    ParticleSystem
    Ribbon
    SkinnedMesh
    Sprite

Renderers（渲染器，可以渲染到不同对象上）

    CanvasRenderer
    WebGLRenderer（使用WebGL渲染，这是本书中最常用的方式）
    WebGLRenderTarget
    WebGLRenderTargetCube
    WebGLShaders（着色器，在最后一章作介绍）

Renderers / Renderables

    RenderableFace3
    RenderableFace4
    RenderableLine
    RenderableObject
    RenderableParticle
    RenderableVertex

Scenes（场景）

    Fog
    FogExp2
    Scene

Textures（纹理）

    CompressedTexture
    DataTexture
    Texture

Extras

    FontUtils
    GeometryUtils
    ImageUtils
    SceneUtils

Extras / Animation

    Animation
    AnimationHandler
    AnimationMorphTarget
    KeyFrameAnimation

Extras / Cameras

    CombinedCamera
    CubeCamera

Extras / Core

    Curve
    CurvePath
    Gyroscope
    Path
    Shape

Extras / Geometries（几何形状）

    CircleGeometry
    ConvexGeometry
    BoxGeometry
    CylinderGeometry
    ExtrudeGeometry
    IcosahedronGeometry
    LatheGeometry
    OctahedronGeometry
    ParametricGeometry
    PlaneGeometry
    PolyhedronGeometry
    ShapeGeometry
    SphereGeometry
    TetrahedronGeometry
    TextGeometry
    TorusGeometry
    TorusKnotGeometry
    TubeGeometry

Extras / Helpers

    ArrowHelper
    AxisHelper
    CameraHelper
    DirectionalLightHelper
    HemisphereLightHelper
    PointLightHelper
    SpotLightHelper

Extras / Objects

    ImmediateRenderObject
    LensFlare
    MorphBlendMesh

Extras / Renderers / Plugins

    DepthPassPlugin
    LensFlarePlugin
    ShadowMapPlugin
    SpritePlugin

Extras / Shaders

    ShaderFlares
    ShaderSprite